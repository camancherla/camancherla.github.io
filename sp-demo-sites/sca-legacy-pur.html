<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sourcepoint Demo: Legacy script</title>
    <link rel="icon" href="data:,">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

 
<script type="text/javascript">
    !function () { var e = function () { var e, t = "__tcfapiLocator", a = [], n = window; for (; n;) { try { if (n.frames[t]) { e = n; break } } catch (e) { } if (n === window.top) break; n = n.parent } e || (!function e() { var a = n.document, r = !!n.frames[t]; if (!r) if (a.body) { var i = a.createElement("iframe"); i.style.cssText = "display:none", i.name = t, a.body.appendChild(i) } else setTimeout(e, 5); return !r }(), n.__tcfapi = function () { for (var e, t = arguments.length, n = new Array(t), r = 0; r < t; r++)n[r] = arguments[r]; if (!n.length) return a; if ("setGdprApplies" === n[0]) n.length > 3 && 2 === parseInt(n[1], 10) && "boolean" == typeof n[3] && (e = n[3], "function" == typeof n[2] && n[2]("set", !0)); else if ("ping" === n[0]) { var i = { gdprApplies: e, cmpLoaded: !1, cmpStatus: "stub" }; "function" == typeof n[2] && n[2](i) } else a.push(n) }, n.addEventListener("message", (function (e) { var t = "string" == typeof e.data, a = {}; try { a = t ? JSON.parse(e.data) : e.data } catch (e) { } var n = a.__tcfapiCall; n && window.__tcfapi(n.command, n.version, (function (a, r) { var i = { __tcfapiReturn: { returnValue: a, success: r, callId: n.callId } }; t && (i = JSON.stringify(i)), e.source.postMessage(i, "*") }), n.parameter) }), !1)) }; "undefined" != typeof module ? module.exports = e : e() }();
</script> 

 
<script>



window._sp_queue = [];
window._sp_ = {
    config: {
        accountId: 22,
        propertyHref : "https://sca-legacy-pur",
        baseEndpoint: 'https://preprod-cdn.privacy-mgmt.com',
        gdpr: {
           targetingParams:{            
                            puremode: true          
                }
        },
         
        consentLanguage: 'tl',
             
    }
}
 
</script>
   
    <script src="https://preprod-cdn.privacy-mgmt.com/wrapperMessagingWithoutDetection.js"></script>

  
    
</head>
 
 
<body  >

    <script type="text/javascript">
         /* __tcfapi('addEventListener', 2, function(tcData,success){
              if(success && (tcData.eventStatus === 'tcloaded' || tcData.eventStatus === 'useractioncomplete') ){
                __tcfapi('getTCData', 2, function (tcData, success) {
                    if(Object.keys( tcData.vendor.consents).length === 0){
                        window._sp_.executeMessaging();
                    }
                });
              }
            });
*/

var vid = '5e717c8e69966540e4554f05';
var pid = '620f71f7feb10305e170a8f6'; // RHP: Fremdinhalte darstellen

function postConsent(){
    let purposeIds = [
           pid
        ];
    __tcfapi('postCustomConsent', 2, function(data, success) {
            console.debug('Response from tcfapi',data, success);
        }, [vid], purposeIds, [] );

}

function getConsents()
{
    __tcfapi('getCustomVendorConsents', 2, function (data, success) {
        if (!success) {
            console.warn('getCustomVendorConsents() failed !');
            return;
        }
        console.log('getCustomVendorConsents()', data);
        let granted_vendors = [];
        for (let vendor_id in data.grants)
        {
            if (data.grants[vendor_id].purposeGrants[pid] ?? false) // RHP: Fremdinhalte
            {
                granted_vendors.push(vendor_id);
            }
        }
        if (granted_vendors.indexOf(vid) >=0)
            console.log(vid + " is granted");
        else
            console.log("vendor not granted");
        console.log("granted", granted_vendors);
    });
}



    </script>
<button onclick="postConsent()">Post Consent</button>
    <button onclick="getConsents()">Get Consents</button>
 
</body>
</html>